

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.jpg">
  <link rel="icon" href="/img/fluid.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Ysc">
  <meta name="keywords" content="">
  
    <meta name="description" content="PCB设计中EMC问题">
<meta property="og:type" content="article">
<meta property="og:title" content="PCB设计中EMC问题">
<meta property="og:url" content="https://ysc2.github.io/ysc2.github.io/2024/05/05/PCB%E8%AE%BE%E8%AE%A1%E4%B8%AD%E7%9A%84EMC%E9%97%AE%E9%A2%98/index.html">
<meta property="og:site_name" content="Ysc Web">
<meta property="og:description" content="PCB设计中EMC问题">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://picgo-ysc.oss-cn-shenzhen.aliyuncs.com/web/wallhaven-l8rp8l.png">
<meta property="article:published_time" content="2024-05-05T08:53:00.000Z">
<meta property="article:modified_time" content="2024-05-06T14:04:03.360Z">
<meta property="article:author" content="Ysc">
<meta property="article:tag" content="转载">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://picgo-ysc.oss-cn-shenzhen.aliyuncs.com/web/wallhaven-l8rp8l.png">
  
  
  
  <title>PCB设计中EMC问题 - Ysc Web</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"ysc2.github.io","root":"/","version":"1.9.5","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"c"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Ysc博客</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://picgo-ysc.oss-cn-shenzhen.aliyuncs.com/web/wallhaven-l8rp8l.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="PCB设计中EMC问题"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-05-05 16:53" pubdate>
          2024年5月5日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          8.8k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          73 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">PCB设计中EMC问题</h1>
            
            
              <div class="markdown-body">
                
                <p>PCB设计中EMC问题</p>
<span id="more"></span>


<p>本篇教程参考自克莱门森大学Todd Hubing博士和Nancy Hubing博士的网站LearnEMC.com</p>
<p>本教程仅供学习参考使用，所有权利归属LearnEMC.com网站。原文链接<a target="_blank" rel="noopener" href="https://learnemc.com/pcb-layout">PCB Layout – LearnEMC</a></p>
<p>一些电路设计是在微小硅晶片上制造的，其他电路设计由通过电缆连接的各种组件组成。然而，电子兼容性工程师的注意重点一直是印刷在玻璃纤维环氧树脂上的印刷电路PCB。下图所示的印刷电路版PCB可以在几乎所有的电子系统中找到：带金属引脚的电路元件由铜质导线连接，表面装贴器件（SMT）贴装在电路板的顶部或底部，通孔元件（TH）通过穿过电路板的引脚焊接在板上。<img src="https://picgo-ysc.oss-cn-shenzhen.aliyuncs.com/web/202405062154975.png" srcset="/img/loading.gif" lazyload></p>
<p>多层板通常具有实心铜平面的整个层以将功率分配给板上的元件。 这些平面通常以它们连接的元件引脚命名。 例如，将所有元件的VCC引脚连接到电源的铜平面通常称为VCC平面。</p>
<p>PCB上元件的放置和走线路径通常在确定采用PCB的产品的电磁兼容性方面起关键作用。 良好布局的电路板将不会放出大量辐射，并且尽量减少可能将噪声与电缆或其他物体耦合在一起的电流和场。良好布局的电路板也可以将外部电流或场将干扰信号耦合到电路板上的机会降到最低。</p>
<p>大多数电路板设计师都采用了一系列设计指南来帮助放置组件和路线。 例如，典型的设计指南可能是“最小化携带数字时钟信号的所有走线的长度”。通常，电路板设计师并不理解这些设计指南的背后原因，或是并不了解违反这些设计指南而可能造成的后果。</p>
<p><em><strong>小测验</strong></em></p>
<p><em>假设您正在给一个高速多层PCB布局，并且您需要将携带高频信号的导线从数字器件连接到模拟放大器。 您希望尽可能减少电磁兼容性（EMC）问题的机会，因此您可以在网络上搜索EMC设计指南，并找到与您的情况有关的三个设计指南：</em></p>
<p><em>1.最小化高速走线的长度;</em><br><em>2.总是在模拟和数字电路之间留下间隙;</em> <br><em>3.不要让高速走线跨过信号间隙。</em></p>
<p>_基于以上的三个设计指南，有如下图所示的三种设计方案。方案a直接连接了数字电路和模拟电路，但因此模拟电路和数字电路之间没有阻隔间隙：方案b用间隙阻隔了模拟电路和数字电路，但高速走线的长度增加了许多：方案c在模拟和数字电路之间留下了分隔的间隙而且高速走线的长度很短，可因此高速走线跨过了分隔间隙。哪种设计方案才是最好的呢？或者，是否因为三种设计都违反了某一条设计指南，所以这三种设计方案都不是好方案？</p>
<p><img src="https://picgo-ysc.oss-cn-shenzhen.aliyuncs.com/web/202405062155223.png" srcset="/img/loading.gif" lazyload></p>
<p><em>这些是电路板设计们每天都要面临的问题。 做出正确选择可以让电路板的电磁兼容性通过EMC测试，反之则会产生严重的电磁兼容性问题。 在本题中，其中一个选择比其他两个更好。 然而，在我们揭示正确的答案之前，让我们制定一个评估印刷电路板布局的策略。 通过适当的策略，这个测验问题的正确答案应该是显而易见的。本题答案在文章最后揭晓。</em></p>
<p>在本教程中，我们将探讨每个EMC工程师在布置印刷电路板或查看现有电路板设计时应采用的四个步骤。 这些步骤是：</p>
<ul>
<li><strong>识别潜在的EMI来源和受害者</strong></li>
<li><strong>识别重要的电流路径</strong></li>
<li><strong>识别潜在的天线部件</strong></li>
<li><strong>探索可能的耦合机制</strong></li>
</ul>
<p>通过以上四步的分析，PCB元器件的布局和导线的走线将会十分清晰。我们将了解，在特定的电路中，哪些设计指南更重要，哪些设计指南不太重要。</p>
<h2 id="识别潜在的EMI来源和受害者"><a href="#识别潜在的EMI来源和受害者" class="headerlink" title="识别潜在的EMI来源和受害者"></a>识别潜在的EMI来源和受害者</h2><p>典型的电路板可能有几十个，几百个甚至数千个电路。 每个电路是可能最终无意地耦合到其他电路或器件的潜在的能量源。 每个电路也是无意耦合噪声的潜在受害者。 然而，一些电路比其他电路更可能成为噪声源，而其他电路更有可能成为受害者。 EMC工程师和电路板设计师应该能够识别那些潜在的良好来源和潜在最易受影响的电路。 下面讨论特别感兴趣的电路。</p>
<h3 id="数字时钟电路"><a href="#数字时钟电路" class="headerlink" title="数字时钟电路"></a>数字时钟电路</h3><p>同步数字电路使用系统时钟把时钟信号发送到电路板上每个需要时钟信号的有源器件上。 时钟信号不断切换并具有窄带谐波。 它们通常是印刷电路板上最有活力的信号之一。 因此，在时钟频率的谐波处看到窄带辐射发射峰值并不罕见。下图是一个含有25MHz时钟的发射频谱。</p>
<p><img src="https://picgo-ysc.oss-cn-shenzhen.aliyuncs.com/web/202405062156528.png" srcset="/img/loading.gif" lazyload></p>
<p>在该图中，辐射发射明显地由25MHz时钟的谐波支配。 200 – 1000 MHz的噪声基准是用于进行测量的频谱分析仪的热噪声（经过校正以反映天线因子）。 为了使本产品符合FCC或CISPR B类辐射发射规范，时钟源振幅必须降低以使无意的“天线”效率较低，或源-天线耦合路径衰减。</p>
<h3 id="数字信号"><a href="#数字信号" class="headerlink" title="数字信号"></a>数字信号</h3><p>数字印刷电路板上的大多数导线都携带数字信息而不是时钟信号。 数字信号不像时钟信号一样周期，而且它们的随机性质会导致更宽带的噪声。 数字信号更频繁地切换可导致类似于时钟信号的辐射。 比如，微处理器地址总线中的最低有效位，因为连续的地址可能会导致该信号在时钟频率上切换。 来自数字信号的辐射的确切形式和强度取决于许多因素，包括软件运行和采用的编码方案。 一般来说，数据信号比时钟信号要麻烦得多; 然而高速数据仍然会产生大量的噪音。</p>
<h3 id="电源开关电路"><a href="#电源开关电路" class="headerlink" title="电源开关电路"></a>电源开关电路</h3><p>开关模式电源和DC-DC转换器通过快速切换电流进入变压器来产生不同的电压。典型的开关频率在10 – 100 kHz范围内。由此开关产生的电流的尖峰可以将噪声耦合到电源输出和电路板上的其他设备。虽然该噪声信号是相对周期性的（即，窄带谐波），但是由于谐波频率之间的距离低于测量的分辨率带宽，所以在辐射发射测试期间它看起来是宽带噪声。</p>
<p>上图中120MHz处的噪声的小驼峰是由于电源开关噪声引起的。 在本产品中，相对于时钟噪声，开关噪声可忽略不计。 然而，在其他产品中，功率开关噪声可以占主导地位，因为只有开关噪声的高次谐波落在辐射发射测量的频率范围内。 我们可以通过减慢开关电路的转换时间来降低功率开关噪声。 然而，这降低了电源的效率，所以最好采用其他的替代方法。</p>
<h3 id="模拟信号"><a href="#模拟信号" class="headerlink" title="模拟信号"></a>模拟信号</h3><p>模拟信号既可以是宽带也可以是窄带，既可以在高频也可以在低频。 如果电路板上采用的是模拟信号，那么就需要我们熟悉这些信号在时域和频域上特性。 窄带，高频模拟信号可能特别难。但幸运的是，由于模拟信号对低电平的噪声更敏感，所以通常可以用最小化辐射发射的方式布局来解决信号完整性的问题。</p>
<h3 id="直流电源导线和低速数字信号"><a href="#直流电源导线和低速数字信号" class="headerlink" title="直流电源导线和低速数字信号"></a>直流电源导线和低速数字信号</h3><p>一般来说，直流电源和低速数字信号在辐射发射频率上的功率不足以造成麻烦。 然而，这些导线往往是最难发现的EMC问题。 这是因为这些导线上的无意的高频电压和电流有时会高于高速信号导线上的电压和电流。</p>
<p><img src="https://picgo-ysc.oss-cn-shenzhen.aliyuncs.com/web/202405062156977.png" srcset="/img/loading.gif" lazyload></p>
<p>上图展示了在个人计算机中常用的动态随机存取存储器模块上的近磁场的映射。 近磁场反映了元件封装内的电流的流动。 测量频率是时钟频率的三次谐波。 请注意，从直流电源引脚抽出的电流大于从信号引脚拉出的电流。</p>
<p><img src="https://picgo-ysc.oss-cn-shenzhen.aliyuncs.com/web/202405062156679.png" srcset="/img/loading.gif" lazyload></p>
<p>上图展示了用现场可编程门阵列（FPGA）中实现的微处理器上的近磁场的类似图像。在该图中，我们看到注入到一些低速地址线上的电流几乎与时钟信号中的电流一样强。</p>
<p>高频电流和电压怎样才会在低频数据线上出现？出现的原因大多数都与连接到这些导线的集成电路（IC）的设计和布局有关。一些IC做的很好，内部产生的噪音处理得很好，而有些IC则不然。不良IC设计可能会在与IC连接的每个输入和输出导线上产生高频电压波动。好的IC设计则不会如此。</p>
<p>当布局具有高频内部时钟而又并不熟悉IC内部特性的PCB时，最好将该IC上的每个引脚都像它是与内部时钟相同特性的高频源一样对待。否则，电源或低速数字走线可能是辐射发射最重要的来源。</p>
<h2 id="识别电流回路"><a href="#识别电流回路" class="headerlink" title="识别电流回路"></a>识别电流回路</h2><p>数字电路工程师和EMC工程师的最大区别可能就在于EMC工程师会把电路里的电流流向跟电路电压看得同样重要。这是非常重要的一点。许多不良设计就是忽视了信号电流流向的直接结果。</p>
<p>下面回顾两个电路设计的主要概念。首先也是最重要的一点：</p>
<p><strong>1. 电流总是形成一个回路</strong></p>
<p><strong>2. 电流总是沿着最小阻抗的路径流动</strong></p>
<p>在低频段（kHz或更低），阻抗大小由电阻值决定。所以电流路径沿着最小阻值流动。在高频段（MHz或更高），阻抗大小由电感值决定，所以电流路径沿着最小电感流动。</p>
<p>考虑下图所示的电路板布局。50MHz的信号在平面上连接元件A跟元件B的的导线上传播。我们知道等量的电流必须从元件B流向元件A。在这种情况下，我们假设这个电流由元件B的GND脚流出，流到元件A的GND脚。 由于这两个元件的GND脚彼此接近而且中间由铜层填充，所以我们很有认为：电流在它们之间采用最短的路径流动（如PATH1所示）。 但是现在我们知道这是不正确的。 高频情况下电流采用最小电感或最小环路径的路径。 因此，在平面上返回的大部分信号电流直接沿信号导线下方的窄路径（PATH2）中流动。</p>
<p><img src="https://picgo-ysc.oss-cn-shenzhen.aliyuncs.com/web/202405062159601.png" srcset="/img/loading.gif" lazyload></p>
<p>如果电路板上的某个层处于某种原因被隔断了，如下图所示，隔断2几乎不会给信号完整性和辐射发射产生影响，而隔断1可能会导致严重的问题。导线下层上的返回电流不得不沿着隔断边沿流动，这样会大幅增加信号闭环的区域。</p>
<p><img src="https://picgo-ysc.oss-cn-shenzhen.aliyuncs.com/web/202405062159213.png" srcset="/img/loading.gif" lazyload></p>
<p>在低频波段（通常是kHz或者更低），电路板层的电阻倾向于扩散电流，以使得两个相距较远的点之间的电流可以覆盖大部分的电路板，如下图所示。</p>
<p><img src="https://picgo-ysc.oss-cn-shenzhen.aliyuncs.com/web/202405062159461.png" srcset="/img/loading.gif" lazyload></p>
<p>在有低频模拟元件跟数字元件的混合信号板上电流这样传播就会出现问题。下图中，在Ground层正确放置隔断可以保护特定区域的电路不受低频返回电流的影响。</p>
<p><img src="https://picgo-ysc.oss-cn-shenzhen.aliyuncs.com/web/202405062159366.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="识别天线"><a href="#识别天线" class="headerlink" title="识别天线"></a>识别天线</h2><p>EMC工程师遇到的大多数造成有效辐射天线往往是无心造成的。这类天线通常满足三个条件：</p>
<ol>
<li>天线必须由两部分组成</li>
<li>这两部分在电气上不能视为『小』</li>
<li>这两部分之间必须形成电压差</li>
</ol>
<p>大多数印刷电路板在低于约100 MHz（λ&gt; 3米）的频率下电气上『较小』。 这意味着任何有效的天线部件必须相对于电路板上的大多数板元件要更大。 通常，在低频下，唯一可行的天线部件是连接的电缆和&#x2F;或金属底盘。 如果以最小化在这些可能的天线部分中的任何两个之间引起电压的可能性的方式来布局PCB，则不太可能导致辐射发射或辐射敏感性问题。</p>
<p>下图展示了两种PCB布局。连接器和外壳连接是可能的有效天线部件。第二种布局在100MHz频率以下产生辐射耦合问题的可能性更低，因为它不太可能在能够用作有效天线的任何两个导体之间产生显着的电压差。可以看到，仅仅通过把两个连接器放在了电路板的同一侧，我们就解决了一个潜在的EMC问题。</p>
<p><img src="https://picgo-ysc.oss-cn-shenzhen.aliyuncs.com/web/202405062156303.png" srcset="/img/loading.gif" lazyload></p>
<p>100MHz以上频率的电磁波波长较短，安装在电路板（或电路板本身）上的物体更可能成为有效的天线部件。然而，即使在高达几GHz的频率下，这些天线部件也应该相对容易发现。例如，在1GHz，自由空间中的波长为30cm。四分之一波长为7.5厘米。因此，有效的天线部分将必须至少几厘米长，并且被相当大小或者更大的东西驱动。回想起差分电流（返回路径在附近的电流）是相对低效的辐射源，这意味着位于其当前返回路径旁边或上方的导线不是良好的天线部件。所以如果我们的天线的一半是板上的金属平面，另一半必须竖起并且远离平面。这有助于使这些天线部件即使在相对较高的频率下也能够容易地识别。下表列出了高于和低于100 MHz的PCB上发现的常见天线部件。</p>
<table><tbody><tr><td colspan="2"><p><strong><span>优良天线部件</span></strong></p></td><td colspan="2"><p><strong><span>不良天线部件</span></strong></p></td></tr><tr><td><p><span>&lt; 100 MHz</span></p></td><td><p><span>&gt; 100 MHz</span></p></td><td><p><span>&lt; 100 MHz</span></p></td><td><p><span><span>&gt; 100 MHz</span></span></p></td></tr><tr><td><p><span>线缆</span></p></td><td><p><span>散热片</span></p></td><td></td><td></td></tr><tr><td></td><td>电源平面（覆铜区域）</td><td><p><span>微波传输带和带状导线</span></p></td><td><span>微波传输带和带状导线</span></td></tr><tr><td></td><td>体积高的元件</td><td><p><span>个头不大的任何部件</span></p></td><td></td></tr><tr><td></td><td><p><span>外壳接缝</span></p></td><td></td><td></td></tr></tbody></table>

<h2 id="识别耦合机制"><a href="#识别耦合机制" class="headerlink" title="识别耦合机制"></a>识别耦合机制</h2><p>当我们识别出电路板上潜在的辐射源&#x2F;受害设备以及潜在的天线以后，使两者之间的耦合最小的设计就是一个好的电路板设计。电磁耦合只有以下四类：</p>
<ul>
<li>传导耦合</li>
<li>电场耦合</li>
<li>磁场耦合</li>
<li>辐射耦合</li>
</ul>
<p>本篇教程讨论的是在同一块板子上的源和天线之间的耦合，所以辐射耦合不作讨论。这样我们只需要考虑前三种耦合机制。传导耦合在只有当我们已经识别出辐射源驱动了靠近它的优良天线时才会发生。传导耦合的一个例子是，信号导线的长度可被视为一个被驱动的有效天线部件，而这个信号导线没有在返回信号层走线。这种情况下，辐射源是信号源，而天线则是『导线-平面（覆铜区域）』对。 显然，直接驱动到导线或其他导体上的高频信号需要在附近的其他导体上返回到其源极，以避免由于源和天线之间的直接传导耦合引起的辐射发射。</p>
<p>一旦辐射源和天线部件被识别出来后，传导耦合就容易被发现了。 然而，场耦合机制往往不那么明显。 为了使场耦合更直观，我们可以将电场耦合视为与源极电压（电压驱动）成比例的耦合，将磁场耦合视为与源极电流（电流驱动）成比例的耦合。</p>
<p><img src="https://picgo-ysc.oss-cn-shenzhen.aliyuncs.com/web/202405062200304.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="电压驱动耦合"><a href="#电压驱动耦合" class="headerlink" title="电压驱动耦合"></a>电压驱动耦合</h3><p>上图a就是一个电压驱动耦合导致辐射发射的例子。上图a中，信号导线在散热片的正下方。如果散热片在电气上不小的话，它就是一个潜在的有效天线部件。电路板的金属层是另外一个潜在的有效天线部件。信号导线并不直接连接散热片，所以不存在传导耦合的路径。然而如图b所示，导线和电路板之间的电场线被散热片截获，导线上的电压可以驱动相对于电路板的散热片。该电场耦合可以用图c中的电容表示。相对于电路板的散热片上的感生电压可由下式表示：</p>
<p><img src="https://picgo-ysc.oss-cn-shenzhen.aliyuncs.com/web/202405062200350.png" srcset="/img/loading.gif" lazyload></p>
<p>通常，电路板设计师会避免在体积较大的散热片下方布置高速信号导线。电场耦合更常见的例子如下图所示。一个主动元件像三明治一样被夹在PCB和散热片中间。同样的，在我们感兴趣的频率范围内，电路板和散热片的体积都不算小。由于元件通过有限电感连接引出高频电流，所以元件的平均电压不等于电路板上的电压，如图a所示。这个电压驱动了元件相对于电路板的表面，如图b中的模型所示。在散热片和电源之间没有直接的连接，所以我们不可能发生传导耦合。然而，在元件表面和散热片直接的电容提供了一个非直接的电场连接。</p>
<p><img src="https://picgo-ysc.oss-cn-shenzhen.aliyuncs.com/web/202405062200468.png" srcset="/img/loading.gif" lazyload></p>
<p>请注意，在上述情况中，驱动产生电压的是电感中的电流。 换句话说，耦合过程中存在磁场。 然而，将元件耦合到天线的场是电场，并且辐射发射与元件相对于电路板的电压成比例。 因此，我们还将此称为电压驱动耦合。</p>
<h3 id="电流驱动耦合"><a href="#电流驱动耦合" class="headerlink" title="电流驱动耦合"></a>电流驱动耦合</h3><p>当源和天线之间的耦合是由于磁场而与信号电流成比例时，这种耦合被称为电流驱动耦合。电路设计师经常考虑电压方面的信号，因此不太可能无意中用信号电压去驱动良好的天线。然而，如果他们忽视考虑电流的流向，那么他们的设计很有可能导致磁场驱动两个具有磁场的良好的天线部件。</p>
<p>下图展示了电流驱动耦合的一个非常常见的例子。设计良好的电路板的两侧都有连接器。我们现在假设电缆是完全屏蔽的，电缆屏蔽层连接到电路板上的GND层。微带导线由在板子的一端被驱动，结束于板子的另一端。电路板上电路在两个连接器中间。</p>
<p>我们已经知道，微带导线不是有效的辐射源，所以这个设计中唯一可能的天线部分是两个屏蔽电缆，它们都是“接地的”。我们期望两个天线部分处于相同的电位，因为它们以大面积的平面（覆铜区域）相互连接。但是，请记住，对于“接地”导体来说，一个重要的要求就是它不会传递有意的电源或信号电流。</p>
<p><img src="https://picgo-ysc.oss-cn-shenzhen.aliyuncs.com/web/202405062200481.png" srcset="/img/loading.gif" lazyload></p>
<p>如图b所示，该设计中的“接地”平面（覆铜区域）确实带有信号电流。事实上，在接地层中流动的电流产生了绕平面（覆铜区域）的磁通量。如果我们将两条电缆视为天线的一部分，并通过天线阻抗来表示天线电流路径，如图c所示，显而易见的是，流过微带导线电路的电流会在驱动的平面上引起一根电缆相对另一根电缆的电压。</p>
<p>虽然在平面上感应的电压通常比信号电压低几个数量级，但高效天线上的几毫伏噪声足以超过FCC和CISPR的辐射发射要求。实际上，当高速数字元件位于非屏蔽产品中的板上的连接器之间时，很难满足辐射发射要求。另一方面，当两个连接器彼此相邻时，磁场不可能在它们之间感生出足够的电压来引起电磁兼容性问题。</p>
<h3 id="对I-O的直接耦合"><a href="#对I-O的直接耦合" class="headerlink" title="对I&#x2F;O的直接耦合"></a>对I&#x2F;O的直接耦合</h3><p>尽管严格来说这并不是一个独立的耦合机制。但PCB布局中常见的问题就是将噪声源直接耦合到了能在电路板上传播噪声信号的导线上。下图就是一个例子。一条普通的高速导线沿着连接到连接器上的另外一条导线走线。从一条导线到另外一条导线耦合的电流和&#x2F;或电压可以沿着I&#x2F;O导线传播并离开电路板。图中所示的例子中，两个天线部件既可以是相对于电路板被驱动的I&#x2F;O线缆也可以是相对于另外一条I&#x2F;O线缆被驱动的I&#x2F;O线缆。</p>
<p><img src="https://picgo-ysc.oss-cn-shenzhen.aliyuncs.com/web/202405062201259.png" srcset="/img/loading.gif" lazyload></p>
<p>你可能认为这种EMC问题很难出现，因为你一眼就看出了这个设计问题。然而在利用自动布线器布线了成百上千条导线的电路板上，这种情况常常发生。如果你使用的自动布线器无法检查在高速导线附近走线的I&#x2F;O走线，那你就应该采用手动布线以避免这种EMC问题。同样的道理也适用于在输入端附近的I&#x2F;O导线，因为电路板上最容易受到辐射噪声的方式就是通过I&#x2F;O的直接耦合。</p>
<h2 id="PCB设计指南"><a href="#PCB设计指南" class="headerlink" title="PCB设计指南"></a>PCB设计指南</h2><p>如前所述，许多电路板设计师都采用了一系列指导原则来帮助放置元件和走线。在我们了解了印刷电路板上的噪声源，天线和耦合机制的相关知识后，我们可以更仔细地探究这些设计指南中，了解它们背后的原因以及在不同情况下它们的重要性。以下是PCB的16个EMC设计指南，以及每个指南的简短解释说明。</p>
<h5 id="1-高速信号或时钟信号导线的走线越短越好"><a href="#1-高速信号或时钟信号导线的走线越短越好" class="headerlink" title="1.高速信号或时钟信号导线的走线越短越好"></a>1.高速信号或时钟信号导线的走线越短越好</h5><p>高速数字信号和时钟通常是最强的噪声源。 导线越长，发生耦合的机会越大。 还要记住，循环面积通常比导线的长度更重要。 确保在每个导线附近都有一个很好的高频电流返回路径。</p>
<h5 id="2-直连到连接器的导线（即I-O导线）的走线越短越好"><a href="#2-直连到连接器的导线（即I-O导线）的走线越短越好" class="headerlink" title="2.直连到连接器的导线（即I&#x2F;O导线）的走线越短越好"></a>2.直连到连接器的导线（即I&#x2F;O导线）的走线越短越好</h5><p>直连到连接器的导线可能是能量到板上或板外的耦合路径。</p>
<h5 id="3-高频信号导线不应当在电路板的I-O元件下方走线"><a href="#3-高频信号导线不应当在电路板的I-O元件下方走线" class="headerlink" title="3.高频信号导线不应当在电路板的I&#x2F;O元件下方走线"></a>3.高频信号导线不应当在电路板的I&#x2F;O元件下方走线</h5><p>在元件下布线的导线可以电容性地或电感性地将能量耦合到该元件。</p>
<h5 id="4-所有连接器应当位于电路板的同一边或同一角上"><a href="#4-所有连接器应当位于电路板的同一边或同一角上" class="headerlink" title="4.所有连接器应当位于电路板的同一边或同一角上"></a>4.所有连接器应当位于电路板的同一边或同一角上</h5><p>连接器是大部分设计中最有效的天线部件。把它们置于电路板的同一侧，可以尽可能地减少驱动一个连接器相对于另一个连接器的共模电压。</p>
<h5 id="5-I-O连接器之间不应当布局高速电路"><a href="#5-I-O连接器之间不应当布局高速电路" class="headerlink" title="5.I&#x2F;O连接器之间不应当布局高速电路"></a>5.I&#x2F;O连接器之间不应当布局高速电路</h5><p>即使两个连接器位于电路板的相同边缘，位于它们之间的高速电路也可以产生足够的共模电压来驱动一个连接器相对于另一个连接器，导致显著的辐射发射。</p>
<h5 id="6-重要的信号导线和时钟导线要埋在Power-Ground层之间"><a href="#6-重要的信号导线和时钟导线要埋在Power-Ground层之间" class="headerlink" title="6.重要的信号导线和时钟导线要埋在Power&#x2F;Ground层之间"></a>6.重要的信号导线和时钟导线要埋在Power&#x2F;Ground层之间</h5><p>把导线布线在两个实体平面（覆铜区域）之间可以有效防止导线发生有害耦合。</p>
<h5 id="7-选择具有最大可接受片外转换时间（-acceptable-off-chip-transition-times-）的主动数字元件"><a href="#7-选择具有最大可接受片外转换时间（-acceptable-off-chip-transition-times-）的主动数字元件" class="headerlink" title="7.选择具有最大可接受片外转换时间（_acceptable off-chip transition times_）的主动数字元件"></a>7.选择具有最大可接受片外转换时间（_acceptable off-chip transition times_）的主动数字元件</h5><p>如果数字波形的转换时间比所需要的时间快，则它产生的高次谐波的功率可能要高得多。 如果使用的逻辑的转换时间比它们需要的更快，它们通常可以使用串联电阻器或铁氧体来降低转换时间。</p>
<h5 id="8-来自单个设备的所有板外信号应该通过同一个连接器连接到PCB"><a href="#8-来自单个设备的所有板外信号应该通过同一个连接器连接到PCB" class="headerlink" title="8.来自单个设备的所有板外信号应该通过同一个连接器连接到PCB"></a>8.来自单个设备的所有板外信号应该通过同一个连接器连接到PCB</h5><p>许多元件（特别是大型超大规模集成电路设备）在不同I &#x2F; O引脚之间产生大量的共模噪声。 如果这些设备中的一个连接到多个连接器，则这种共模噪声将潜在地驱动良好的天线。 （该设备也将更容易受到在这个天线上带来的辐射噪声的影响。）</p>
<h5 id="9-高速（或易感）导线应该至少距电路板边缘2X走线，其中X是导线和它返回电流路径之间的距离"><a href="#9-高速（或易感）导线应该至少距电路板边缘2X走线，其中X是导线和它返回电流路径之间的距离" class="headerlink" title="9.高速（或易感）导线应该至少距电路板边缘2X走线，其中X是导线和它返回电流路径之间的距离"></a>9.高速（或易感）导线应该至少距电路板边缘2X走线，其中X是导线和它返回电流路径之间的距离</h5><p>靠近电路板边缘的导线产生的磁场和电场更不容易被包含。来自和发往天线的串话和耦合往往更大。</p>
<h5 id="10-差分信号导线对应当布线在一起，并始终保持相同距离"><a href="#10-差分信号导线对应当布线在一起，并始终保持相同距离" class="headerlink" title="10.差分信号导线对应当布线在一起，并始终保持相同距离"></a>10.差分信号导线对应当布线在一起，并始终保持相同距离</h5><p>当差分信号对保持平衡时，它们更不易受噪声干扰，也不易产生辐射发射。</p>
<h5 id="11-所有相对于同一个返回电源层（如GND层）的电源层（如电压层）应当在同一层布线"><a href="#11-所有相对于同一个返回电源层（如GND层）的电源层（如电压层）应当在同一层布线" class="headerlink" title="11.所有相对于同一个返回电源层（如GND层）的电源层（如电压层）应当在同一层布线"></a>11.所有相对于同一个返回电源层（如GND层）的电源层（如电压层）应当在同一层布线</h5><p>例如，当一个电路板采用3.3V，3.3V模拟和1V的三种电源，那我们一定希望减少这三层之间的高频耦合。把这三个平面放在同一层将确保它们彼此不会重叠。因为有源器件不太可能在板上任何一个位置需要两个不同的电压，这样也可以提高布局的高效性。</p>
<h5 id="12-在给定层上的任意两个电源平面（覆铜区域）的间距应至少为3mm"><a href="#12-在给定层上的任意两个电源平面（覆铜区域）的间距应至少为3mm" class="headerlink" title="12.在给定层上的任意两个电源平面（覆铜区域）的间距应至少为3mm"></a>12.在给定层上的任意两个电源平面（覆铜区域）的间距应至少为3mm</h5><p>如果在同一层上的两个平面（覆铜区域）靠的太近的话可能发生严重的高频耦合。在极端条件下，也可能产生电弧或短路的问题。</p>
<h5 id="13-在具有电源和接地平面（覆铜区域）的电路板上，不得使用任何导线连接电源或接地。应使用邻近部件的电源或接地焊盘的通孔进行连接"><a href="#13-在具有电源和接地平面（覆铜区域）的电路板上，不得使用任何导线连接电源或接地。应使用邻近部件的电源或接地焊盘的通孔进行连接" class="headerlink" title="13.在具有电源和接地平面（覆铜区域）的电路板上，不得使用任何导线连接电源或接地。应使用邻近部件的电源或接地焊盘的通孔进行连接"></a>13.在具有电源和接地平面（覆铜区域）的电路板上，不得使用任何导线连接电源或接地。应使用邻近部件的电源或接地焊盘的通孔进行连接</h5><p>连接到另外层上平面（覆铜区域）的导线既占据空间又产生电感。如果高频阻抗是个问题的话（比如电源总线解耦连接），这个电感会严重降低连接质量。</p>
<h5 id="14-如果电路板设计上有超过一个接地平面层，那么在给定位置的任意接地连接要连接到所有的接地平面层"><a href="#14-如果电路板设计上有超过一个接地平面层，那么在给定位置的任意接地连接要连接到所有的接地平面层" class="headerlink" title="14.如果电路板设计上有超过一个接地平面层，那么在给定位置的任意接地连接要连接到所有的接地平面层"></a>14.如果电路板设计上有超过一个接地平面层，那么在给定位置的任意接地连接要连接到所有的接地平面层</h5><p>这里的思路是，如果允许，高频电流会采用最低电感的路径流动。不要试图通过只连接某些特定平面来引导这些电流的流动。</p>
<h5 id="15-在接地平面，不应该有任何隔断或缝隙"><a href="#15-在接地平面，不应该有任何隔断或缝隙" class="headerlink" title="15.在接地平面，不应该有任何隔断或缝隙"></a>15.在接地平面，不应该有任何隔断或缝隙</h5><p>有一个全覆铜的接地（信号返回）平面和专用于这个平面的层是最好不过的。任何额外的电源和信号返回必须与地平面直流隔离并在不同于专用接地层的平面上布线。</p>
<h5 id="16-所有电路板上与外壳、线缆和其他优良天线部件有接触或耦合的电源或接地导体在高频段应当连接在一起"><a href="#16-所有电路板上与外壳、线缆和其他优良天线部件有接触或耦合的电源或接地导体在高频段应当连接在一起" class="headerlink" title="16.所有电路板上与外壳、线缆和其他优良天线部件有接触或耦合的电源或接地导体在高频段应当连接在一起"></a>16.所有电路板上与外壳、线缆和其他优良天线部件有接触或耦合的电源或接地导体在高频段应当连接在一起</h5><p>同样称作“地”的不同导体间的电压差是辐射发射和易感性问题的主要来源。</p>
<p>除了上述16项设计指南，电路板设计师通常使用其行业所特有的EMC设计指南。例如，“采用锁相环路的时钟发生电路应该通过＃1234铁氧体磁珠从板上的功率中获得自己的隔离功率。”这些基于经验的设计指南对知识渊博的电路板设计师来说是非常宝贵的。然而，如果不了解这些EMC设计指南产生的原因和它们之所以有效的原因就贸然在其他设计上使用这些EMC设计指南，很可能导致设计出的电路板无法正常工作。所以了解，每个设计指南背后的基本物理学原理是非常重要的。</p>
<p>满足最多条设计指南的设计并不一定是最好的设计。以最低的成本和最高的可靠性实现了所有的性能指标的设计才是最好的设计。</p>
<h2 id="回到最初的题目"><a href="#回到最初的题目" class="headerlink" title="回到最初的题目"></a>回到最初的题目</h2><p>我们已经有了一份EMC设计指南，也了解了这些设计指南背后的物理学原理。现在我们回到最初提出的问题，看看这三种设计中，哪种PCB布局是最好的。</p>
<p>我们可以很轻松地把选项b划掉。这个布局中导线跨过了返回平面上的隔断。选项a采用了最短的导线布局，因此是最好的选项。因为地平面上隔断是没有必要存在的。如果存在低频共模阻抗耦合的问题使得隔断必不可少的话，选项c将导线沿着隔断布线也是还不错的一个选项。记住，相对总环路面积而言，微带导线长度几乎不重要。</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><a target="_blank" rel="noopener" href="https://haipeng.me/2017/08/21/emc-pcb-layout/">原文</a></li>
</ul>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E7%A1%AC%E4%BB%B6/" class="category-chain-item">硬件</a>
  
  
    <span>></span>
    
  <a href="/categories/%E7%A1%AC%E4%BB%B6/%E6%9D%82%E9%A1%B9/" class="category-chain-item">杂项</a>
  
  

  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E8%BD%AC%E8%BD%BD/" class="print-no-link">#转载</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>PCB设计中EMC问题</div>
      <div>https://ysc2.github.io/ysc2.github.io/2024/05/05/PCB设计中的EMC问题/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Ysc</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年5月5日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/05/11/%E4%BD%BF%E7%94%A8qemu%E6%A8%A1%E6%8B%9F%E4%B8%80%E5%9D%97%E5%BC%80%E5%8F%91%E6%9D%BF/" title="使用qemu模拟一块开发板">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">使用qemu模拟一块开发板</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/05/03/%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B%E6%9D%82%E9%A1%B9/" title="系统编程杂项">
                        <span class="hidden-mobile">系统编程杂项</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
